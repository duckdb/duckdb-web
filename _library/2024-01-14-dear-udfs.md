---
layout: post
title: "Dear User-Defined Functions, Inlining isn't working out so great for us. Let's try batching to make our relationship work. Sincerely, SQL"
author: "Kai Franz, Sam Arch, Denis Hirn, Torsten Grust, Todd C. Mowry, Andy Pavlo"
thumb: "/images/library/thumbs/cidr.svg"
image: "/images/library/thumbs/cidr.png"
tags: ["Paper"]
thirdparty: true
---

[Paper (PDF)](https://www.cidrdb.org/cidr2024/papers/p13-franz.pdf)

Venue: CIDR 2024

## Abstract

SQL's user-defined functions (UDFs) allow developers to express complex computation using procedural logic. But UDFs have been the bane of database management systems (DBMSs) for decades because they inhibit optimization opportunities, potentially slowing down queries significantly. In response, batching and inlining techniques have been proposed to enable effective query optimization of UDF calls within SQL. Inlining is now available in a major commercial DBMS. But the trade-offs between both approaches on modern DBMSs remain unclear. We evaluate and compare UDF batching and inlining on enterprise and open-source DBMSs using a state-of-the-art UDF-centric workload. We observe the surprising result that although inlining is better on simple UDFs, batching outperforms inlining by up to 93.4× for more complex UDFs because it makes it easier for a DBMS’s query optimizer to decorrelate subqueries. We propose a hybrid approach that chooses batching or inlining to achieve the best performance.

## Synposis

This paper studies UDF-to-SQL transpilation and inlining and the associated role of decorrelation in DuckDB. It led to Sam Arch's (CMU) implementation of decorrelation for nested `LATERAL` joins in DuckDB.
